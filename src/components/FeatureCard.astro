---
import react from "react";
import Tilt from "react-parallax-tilt";
import { Icon } from "@astrojs/starlight/components";

export interface Props {
  title: string;
  body?: string;
  icon?: string;
}

const { icon, title, body } = Astro.props;
---

<div class="feature-card">
  <Tilt
    client:idle
    className="feature-card-inner m-0 p-0 w-full h-full"
    glareEnable={true}
    glareMaxOpacity={0.8}
    glareColor="var(--sl-color-gray-3)"
    glarePosition="left"
    glareBorderRadius="0.5rem"
    gyroscope={true}
    transitionSpeed={2000}
    tiltMaxAngleX={6}
    tiltMaxAngleY={6}
    tiltReverse={true}
  >
    <article
      class="card flex flex-col flex-grow basis-auto self-stretch w-[100%] h-[100%] border border-solid rounded-lg m-0"
    >
      <h4 class="title font-bold gap-4 items-center">
        <!-- @ts-ignore -->
        {icon && <Icon name={icon} class="icon" size="1.333em" />}
        <span set:html={title} />
      </h4>
      <div class="body m-0">
        {body}
      </div>
    </article>
  </Tilt>
</div>

<style>
  /* Add positioning context fix */
  .feature-card {
    position: relative;
    display: block;
    width: 100%;
    height: 100%;
  }

  /* Ensure Tilt wrapper doesn't create offset */
  .feature-card :global(.tilt) {
    display: block !important;
    width: 100% !important;
    height: 100% !important;
    position: relative !important;
  }

  /* Reset any transforms that might cause offset */
  .feature-card :global(.tilt-inner) {
    transform-style: preserve-3d;
    position: relative;
    width: 100%;
    height: 100%;
  }

  .card {
    border-color: var(--sl-color-gray-5);
    background: color-mix(in lab, transparent 70%, var(--sl-color-black));
    backdrop-filter: blur(16px);
    padding: clamp(1rem, calc(0.125rem + 3vw), 2.5rem);
    gap: clamp(0.5rem, calc(0.125rem + 1vw), 1rem);
    /* Use CSS custom properties for colors */
    --card-title-color: var(--sl-color-white);
    --card-body-color: var(--sl-color-gray-2);
  }

  .title {
    color: var(--card-title-color);
    line-height: var(--sl-line-height-headings);
  }

  .card .icon {
    border: 1px solid var(--sl-card-border);
    background-color: var(--sl-card-bg);
    padding: 0.2em;
    border-radius: 0.25rem;
  }

  .card .body {
    font-size: clamp(
      var(--sl-text-sm),
      calc(0.5rem + 1vw),
      var(--sl-text-body)
    );
    color: var(--card-body-color);
  }

  /* Light mode specific fixes with higher specificity */
  :global([data-theme="light"]) .card {
    background: color-mix(in lab, var(--sl-color-white) 90%, transparent);
    --card-title-color: #000000;
    --card-body-color: #333333;
  }

  /* Additional specificity for light mode to ensure it works */
  :global(html[data-theme="light"]) .card .title {
    color: #000000 !important;
  }

  :global(html[data-theme="light"]) .card .body {
    color: #333333 !important;
  }
</style>
